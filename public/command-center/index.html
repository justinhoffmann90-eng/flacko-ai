<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Command Center ‚Äî Clawd</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
      min-height: 100vh;
      color: #fff;
    }

    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .logo { display: flex; align-items: center; gap: 12px; }
    .logo span { font-size: 2rem; }
    .logo h1 { font-size: 1.4rem; font-weight: 600; }

    nav { display: flex; gap: 15px; }
    nav a {
      color: rgba(255,255,255,0.6);
      text-decoration: none;
      font-size: 0.9rem;
      padding: 8px 16px;
      border-radius: 8px;
      transition: all 0.2s;
    }
    nav a:hover { color: #fff; background: rgba(255,255,255,0.1); }
    nav a.active { color: #fff; background: rgba(96,165,250,0.2); }

    /* Stats Row */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 5px;
    }
    .stat-number.blue { color: #60a5fa; }
    .stat-number.green { color: #4ade80; }
    .stat-number.yellow { color: #fbbf24; }
    .stat-number.red { color: #f87171; }

    .stat-label {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.5);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Section */
    .section {
      margin-bottom: 30px;
    }

    .section-header {
      margin-bottom: 20px;
    }
    .section-header h2 {
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* The Desk - Role Cards */
    .desk-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      justify-content: center;
    }
    
    @media (min-width: 1200px) {
      .desk-grid {
        grid-template-columns: repeat(5, 1fr);
      }
    }

    .role-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      overflow: hidden;
    }

    .role-header {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .role-emoji { font-size: 1.5rem; }
    .role-name { font-weight: 600; font-size: 1rem; flex: 1; }

    .role-status {
      font-size: 0.65rem;
      padding: 4px 10px;
      border-radius: 12px;
      text-transform: uppercase;
      font-weight: 600;
    }
    .role-status.active { background: rgba(74,222,128,0.2); color: #4ade80; }
    .role-status.planned { background: rgba(251,191,36,0.2); color: #fbbf24; }

    .role-body { padding: 16px 20px; }

    .role-section-title {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: rgba(255,255,255,0.4);
      margin-bottom: 10px;
      margin-top: 16px;
    }
    .role-section-title:first-child { margin-top: 0; }

    .role-item {
      padding: 8px 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      margin-bottom: 6px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .role-item.blocker {
      background: rgba(248,113,113,0.1);
      border-left: 3px solid #f87171;
    }

    .task-time {
      font-size: 0.75rem;
      color: #60a5fa;
      font-family: monospace;
      min-width: 45px;
    }

    .priority-badge {
      font-size: 0.65rem;
      padding: 2px 8px;
      border-radius: 8px;
      margin-left: auto;
    }
    .priority-badge.high { background: rgba(248,113,113,0.2); color: #f87171; }
    .priority-badge.medium { background: rgba(251,191,36,0.2); color: #fbbf24; }

    .empty-state {
      color: rgba(255,255,255,0.3);
      font-size: 0.8rem;
      padding: 12px;
      text-align: center;
    }

    /* Bottom Panels */
    .bottom-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .panel {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 20px;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .panel-title {
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-count {
      background: rgba(96,165,250,0.2);
      color: #60a5fa;
      font-size: 0.75rem;
      padding: 3px 10px;
      border-radius: 10px;
    }

    /* Cron Jobs */
    .cron-list { display: flex; flex-direction: column; gap: 8px; max-height: 300px; overflow-y: auto; }

    .cron-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
    }
    .cron-item.completed { background: rgba(74, 222, 128, 0.1); border-left: 3px solid #4ade80; }
    .cron-item.pending { background: rgba(251, 191, 36, 0.05); border-left: 3px solid rgba(251, 191, 36, 0.3); }
    .cron-item.failed { background: rgba(248, 113, 113, 0.1); border-left: 3px solid #f87171; }

    .cron-status { font-size: 1rem; }
    .cron-name { font-size: 0.85rem; font-weight: 500; flex: 1; }
    .cron-time { font-size: 0.75rem; color: rgba(255,255,255,0.4); font-family: monospace; }

    /* Activity */
    .activity-list { 
      display: flex; 
      flex-direction: column; 
      gap: 8px; 
      max-height: 500px; 
      overflow-y: auto; 
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.2) transparent;
    }
    .activity-list::-webkit-scrollbar { width: 6px; }
    .activity-list::-webkit-scrollbar-track { background: transparent; }
    .activity-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
    .activity-list::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }

    .activity-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      background: rgba(255,255,255,0.02);
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .activity-icon { font-size: 1rem; }
    .activity-agent { 
      font-size: 1rem; 
      min-width: 24px; 
      text-align: center;
    }
    .activity-text { flex: 1; color: rgba(255,255,255,0.7); }
    .activity-time { font-size: 0.7rem; color: rgba(255,255,255,0.3); white-space: nowrap; }
    .activity-date { font-size: 0.65rem; color: rgba(255,255,255,0.25); margin-left: 8px; }

    .last-updated {
      text-align: center;
      color: rgba(255,255,255,0.3);
      font-size: 0.75rem;
      margin-top: 25px;
    }

    /* Sources Monitored Band */
    .sources-band {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      padding: 16px 24px;
      margin-bottom: 30px;
    }

    .sources-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 14px;
    }

    .sources-header span {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: rgba(255,255,255,0.35);
    }

    .sources-line {
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      max-width: 100px;
    }

    .sources-grid {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 24px;
    }

    .source-item {
      display: flex;
      align-items: center;
      gap: 8px;
      opacity: 0.6;
      transition: opacity 0.2s;
      padding: 6px 12px;
      border-radius: 8px;
    }

    .source-item:hover {
      opacity: 1;
      background: rgba(255,255,255,0.05);
    }

    .source-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .source-icon svg {
      width: 18px;
      height: 18px;
    }

    .source-name {
      font-size: 0.8rem;
      font-weight: 500;
      color: rgba(255,255,255,0.8);
    }

    /* Brand colors */
    .source-item.discord .source-icon { color: #5865F2; }
    .source-item.x .source-icon { color: #fff; }
    .source-item.spotgamma .source-icon { color: #00D4AA; }
    .source-item.fsinsight .source-icon { color: #FF6B35; }
    .source-item.cnbc .source-icon { color: #005594; }
    .source-item.reuters .source-icon { color: #FF8000; }
    .source-item.yahoo .source-icon { color: #720e9e; }
    .source-item.tradingview .source-icon { color: #2962FF; }

    @media (max-width: 900px) {
      .stats-row { grid-template-columns: repeat(2, 1fr); }
      .bottom-grid { grid-template-columns: 1fr; }
      .sources-grid { gap: 16px; }
      .source-name { display: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <span>ü§ñ</span>
        <h1>Command Center</h1>
      </div>
      <nav>
        <a href="index.html" class="active">Dashboard</a>
        <a href="workflow.html">Workflow</a>
        <a href="flow.html">Flow</a>
        <a href="roles.html">Roles</a>
        <a href="report.html">Report</a>
      </nav>
    </header>

    <!-- Stats Row -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-number blue" id="scheduledCount">0</div>
        <div class="stat-label">Scheduled</div>
      </div>
      <div class="stat-card">
        <div class="stat-number green" id="completedCount">0</div>
        <div class="stat-label">Completed Today</div>
      </div>
      <div class="stat-card">
        <div class="stat-number yellow" id="inProgressCount">0</div>
        <div class="stat-label">Pending</div>
      </div>
      <div class="stat-card">
        <div class="stat-number red" id="blockerCount">0</div>
        <div class="stat-label">Blockers</div>
      </div>
    </div>

    <!-- Data Verification Panel -->
    <div class="panel" style="margin-bottom: 30px;">
      <div class="panel-header">
        <span class="panel-title">üîç Data Verification</span>
        <span class="panel-count" id="verificationStatus">Loading...</span>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <!-- Latest Report -->
        <div>
          <div style="font-size: 0.75rem; color: rgba(255,255,255,0.4); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">Latest Daily Report</div>
          <div id="reportInfo" style="font-size: 0.9rem; line-height: 1.6;">
            <div style="display: flex; gap: 8px; margin-bottom: 6px;">
              <span style="color: rgba(255,255,255,0.5);">File:</span>
              <span id="reportFilename">‚Äî</span>
            </div>
            <div style="display: flex; gap: 8px; margin-bottom: 6px;">
              <span style="color: rgba(255,255,255,0.5);">Date:</span>
              <span id="reportDate">‚Äî</span>
            </div>
            <div style="display: flex; gap: 8px;">
              <span style="color: rgba(255,255,255,0.5);">Modified:</span>
              <span id="reportModified">‚Äî</span>
            </div>
          </div>
        </div>
        <!-- Key Levels Config -->
        <div>
          <div style="font-size: 0.75rem; color: rgba(255,255,255,0.4); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">Key Levels Config</div>
          <div id="keyLevelsInfo" style="font-size: 0.9rem; line-height: 1.6;">
            <div style="display: flex; gap: 8px; margin-bottom: 6px;">
              <span style="color: rgba(255,255,255,0.5);">Source:</span>
              <span id="keyLevelsSource">‚Äî</span>
            </div>
            <div style="display: flex; gap: 8px; margin-bottom: 6px;">
              <span style="color: rgba(255,255,255,0.5);">Updated:</span>
              <span id="keyLevelsUpdated">‚Äî</span>
            </div>
            <div style="display: flex; gap: 8px;">
              <span style="color: rgba(255,255,255,0.5);">Master Eject:</span>
              <span id="masterEject" style="color: #f87171; font-weight: 600;">‚Äî</span>
            </div>
          </div>
        </div>
      </div>
      <!-- Key Levels Table -->
      <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.08);">
        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.4); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">Active Alert Levels</div>
        <div id="levelsTable" style="display: grid; grid-template-columns: auto 1fr auto; gap: 8px; font-size: 0.85rem; max-height: 300px; overflow-y: auto;">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- Sources Monitored -->
    <div class="sources-band">
      <div class="sources-header">
        <div class="sources-line"></div>
        <span>üîç Continuous Monitoring</span>
        <div class="sources-line"></div>
      </div>
      <div class="sources-grid">
        <div class="source-item discord">
          <span class="source-icon">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>
          </span>
          <span class="source-name">Discord</span>
        </div>
        <div class="source-item x">
          <span class="source-icon">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          </span>
          <span class="source-name">X</span>
        </div>
        <div class="source-item spotgamma">
          <span class="source-icon">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
          </span>
          <span class="source-name">SpotGamma</span>
        </div>
        <div class="source-item fsinsight">
          <span class="source-icon">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
          </span>
          <span class="source-name">FS Insight</span>
        </div>
        <div class="source-item cnbc">
          <span class="source-icon">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/></svg>
          </span>
          <span class="source-name">CNBC</span>
        </div>
        <div class="source-item reuters">
          <span class="source-icon">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
          </span>
          <span class="source-name">Reuters</span>
        </div>
        <div class="source-item yahoo">
          <span class="source-icon">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.736 2L7.047 12.5l.654 1.145L12.5 6.65l4.764 8.35H12.5l-.654 1.145L7.047 22h3.272l2.181-3.855L14.681 22h3.272l-4.799-8.355L17.953 2h-3.272l-1.945 3.41L10.791 2z"/></svg>
          </span>
          <span class="source-name">Yahoo Finance</span>
        </div>
        <div class="source-item tradingview">
          <span class="source-icon">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 17h2v-7H3v7zm4 0h2V7H7v10zm4 0h2V4h-2v13zm4 0h2v-4h-2v4zm4 0h2v-9h-2v9z"/></svg>
          </span>
          <span class="source-name">TradingView</span>
        </div>
      </div>
    </div>

    <!-- The Desk -->
    <div class="section">
      <div class="section-header">
        <h2>üë• The Desk</h2>
      </div>
      <div class="desk-grid" id="deskGrid">
        <!-- Role cards populated by JS -->
      </div>
    </div>

    <!-- Bottom Panels -->
    <div class="bottom-grid">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">üìÖ Daily Jobs (resets each day)</span>
          <span class="panel-count" id="cronCount">0</span>
        </div>
        <div class="cron-list" id="cronList">
          <div class="empty-state">No scheduled jobs</div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">üìú Activity Log</span>
          <span class="panel-count" id="activityCount">0</span>
        </div>
        <div class="activity-list" id="activityList">
          <div class="empty-state">No recent activity</div>
        </div>
      </div>
    </div>

    <div class="last-updated" id="lastUpdated">Loading...</div>
  </div>

  <script>
    let rolesData = [];

    function renderVerification(v) {
      try {
        // Report info
        document.getElementById('reportFilename').textContent = v.report.filename;
        document.getElementById('reportDate').textContent = v.report.date;
        const reportMod = new Date(v.report.modified * 1000);
        document.getElementById('reportModified').textContent = reportMod.toLocaleString();

        // Key levels info
        const kl = v.keyLevels.data;
        document.getElementById('keyLevelsSource').textContent = kl.source || 'Unknown';
        const klMod = new Date(v.keyLevels.modified * 1000);
        document.getElementById('keyLevelsUpdated').textContent = klMod.toLocaleString();
        document.getElementById('masterEject').textContent = '$' + (kl.quickReference?.masterEject || kl.tsla?.masterEject || '‚Äî');

        // Verification status
        const reportDate = v.report.date;
        const klReportDate = kl.reportDate;
        const match = reportDate === klReportDate;
        const statusEl = document.getElementById('verificationStatus');
        if (match) {
          statusEl.textContent = '‚úÖ Synced';
          statusEl.style.background = 'rgba(74,222,128,0.2)';
          statusEl.style.color = '#4ade80';
        } else {
          statusEl.textContent = '‚ö†Ô∏è Out of sync';
          statusEl.style.background = 'rgba(251,191,36,0.2)';
          statusEl.style.color = '#fbbf24';
        }

        // Levels table
        const levelsTable = document.getElementById('levelsTable');
        if (kl.levels && kl.levels.length > 0) {
          levelsTable.innerHTML = kl.levels.map(level => {
            let priceColor = '#60a5fa';
            if (level.price === kl.quickReference?.masterEject) priceColor = '#f87171';
            else if (level.emoji === 'üéØ') priceColor = '#4ade80';
            else if (level.emoji === '‚ö†Ô∏è') priceColor = '#fbbf24';
            
            return `
              <div style="color: ${priceColor}; font-weight: 600; font-family: monospace;">$${level.price}</div>
              <div style="color: rgba(255,255,255,0.7);">${level.emoji} ${level.level}</div>
              <div style="color: rgba(255,255,255,0.4); font-size: 0.75rem; text-align: right;">${level.action}</div>
            `;
          }).join('');
        } else {
          levelsTable.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: rgba(255,255,255,0.3); padding: 20px;">No levels configured</div>';
        }
      } catch (e) {
        console.error('Failed to render verification:', e);
        document.getElementById('verificationStatus').textContent = '‚ùå Error';
      }
    }

    async function loadData() {
      try {
        // Load data.json, roles.json, and verification.json
        const [dataRes, rolesRes, verifyRes] = await Promise.all([
          fetch('data.json?' + Date.now()),
          fetch('roles.json?' + Date.now()),
          fetch('verification.json?' + Date.now())
        ]);
        const data = await dataRes.json();
        const rolesJson = await rolesRes.json();
        const verification = await verifyRes.json();
        rolesData = rolesJson.roles || [];

        // Render verification panel
        renderVerification(verification);

        // Last updated
        if (data.lastUpdated) {
          const dateStr = data.date || new Date().toISOString().split('T')[0];
          document.getElementById('lastUpdated').textContent = 
            `üìÖ ${dateStr} ‚Ä¢ Last updated: ` + new Date(data.lastUpdated).toLocaleString();
        }

        // Stats - use dailyJobs from data.json
        const dailyJobs = data.dailyJobs || { summary: { total: 0, completed: 0, pending: 0 }, jobs: [] };
        const blockerCount = data.blockers?.length || 0;

        document.getElementById('scheduledCount').textContent = dailyJobs.summary.total || 0;
        document.getElementById('completedCount').textContent = dailyJobs.summary.completed || 0;
        document.getElementById('inProgressCount').textContent = dailyJobs.summary.pending || 0;
        document.getElementById('blockerCount').textContent = blockerCount;

        // The Desk
        renderDesk();

        // Daily jobs with status
        renderDailyJobs(dailyJobs.jobs || []);

        // Activity
        renderActivity(data.activity);

      } catch (e) {
        console.error('Failed to load data:', e);
      }
    }

    function renderDesk() {
      const grid = document.getElementById('deskGrid');

      grid.innerHTML = rolesData.map(role => {
        const todo = role.todo || [];
        const blockers = role.blockers || [];

        return `
          <div class="role-card">
            <div class="role-header">
              <span class="role-emoji">${role.emoji}</span>
              <span class="role-name">${role.name}</span>
              <span class="role-status ${role.status}">${role.status}</span>
            </div>
            <div class="role-body">
              <div class="role-section-title">To Do</div>
              ${todo.length > 0 
                ? todo.map(item => `
                    <div class="role-item">
                      ${item.time ? `<span class="task-time">${item.time}</span>` : ''}
                      <span>${item.name || item}</span>
                      ${item.priority ? `<span class="priority-badge ${item.priority.toLowerCase()}">${item.priority}</span>` : ''}
                    </div>
                  `).join('')
                : '<div class="empty-state">No items</div>'
              }
              <div class="role-section-title">Blockers</div>
              ${blockers.length > 0 
                ? blockers.map(item => `
                    <div class="role-item blocker">
                      <span>${item.name || item}</span>
                    </div>
                  `).join('')
                : '<div class="empty-state">None</div>'
              }
            </div>
          </div>
        `;
      }).join('');
    }

    function renderDailyJobs(jobs) {
      const list = document.getElementById('cronList');
      const count = document.getElementById('cronCount');
      
      if (jobs && jobs.length > 0) {
        // Sort by time
        const sorted = [...jobs].sort((a, b) => {
          const timeA = parseTime(a.time);
          const timeB = parseTime(b.time);
          return timeA - timeB;
        });
        count.textContent = jobs.length;
        list.innerHTML = sorted.map(job => {
          const statusIcon = job.status === 'completed' ? '‚úÖ' : 
                            job.status === 'failed' ? '‚ùå' : '‚è≥';
          const statusClass = job.status === 'completed' ? 'completed' :
                             job.status === 'failed' ? 'failed' : 'pending';
          const completedAt = job.completedAt ? ` @ ${job.completedAt}` : '';
          return `
            <div class="cron-item ${statusClass}">
              <span class="cron-status">${statusIcon}</span>
              <span class="cron-name">${job.id}</span>
              <span class="cron-time">${job.time}${completedAt}</span>
            </div>
          `;
        }).join('');
      } else {
        count.textContent = '0';
        list.innerHTML = '<div class="empty-state">No scheduled jobs</div>';
      }
    }

    function parseTime(timeStr) {
      if (!timeStr) return 9999;
      // Handle formats like "7:00a", "11:15a", "4:30p", "Sun 10a"
      const match = timeStr.match(/(\d+):?(\d*)([ap])?/i);
      if (!match) return 9999;
      let hour = parseInt(match[1]);
      const min = parseInt(match[2]) || 0;
      const ampm = (match[3] || 'a').toLowerCase();
      if (ampm === 'p' && hour !== 12) hour += 12;
      if (ampm === 'a' && hour === 12) hour = 0;
      return hour * 60 + min;
    }

    function renderActivity(items) {
      const list = document.getElementById('activityList');
      const count = document.getElementById('activityCount');
      if (items && items.length > 0) {
        const icons = { success: '‚úÖ', info: '‚ÑπÔ∏è', warning: '‚ö†Ô∏è', error: '‚ùå' };
        count.textContent = items.length;
        // Show ALL items, no limit
        list.innerHTML = items.map(item => {
          const time = item.time ? new Date(item.time) : null;
          const timeStr = time ? time.toLocaleTimeString([], {hour: 'numeric', minute: '2-digit'}) : '';
          const dateStr = time ? time.toLocaleDateString([], {month: 'short', day: 'numeric'}) : '';
          const agentEmoji = item.agent || 'ü§ñ'; // Default to robot if no agent specified
          return `
            <div class="activity-item">
              <span class="activity-icon">${icons[item.type] || 'üìå'}</span>
              <span class="activity-agent" title="${item.agentName || 'Clawd'}">${agentEmoji}</span>
              <span class="activity-text">${item.message}</span>
              <span class="activity-time">${timeStr}<span class="activity-date">${dateStr}</span></span>
            </div>
          `;
        }).join('');
      } else {
        count.textContent = '0';
        list.innerHTML = '<div class="empty-state">No recent activity</div>';
      }
    }

    loadData();
    setInterval(loadData, 30000);
  </script>
</body>
</html>
