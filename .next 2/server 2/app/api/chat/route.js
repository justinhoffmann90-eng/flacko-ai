"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},5256:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>eu,patchFetch:()=>eh,requestAsyncStorage:()=>ec,routeModule:()=>er,serverHooks:()=>ed,staticGenerationAsyncStorage:()=>el});var s,o,i,a,r,c,l,d,u,h,f,p,g={};n.r(g),n.d(g,{POST:()=>ea});var m=n(9303),E=n(8716),_=n(670),C=n(9692),y=n(7070);(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(s||(s={})),function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"}(o||(o={})),function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(i||(i={}));let O=["user","model","function","system"];(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(a||(a={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(r||(r={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(c||(c={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(l||(l={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"}(d||(d={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(u||(u={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(h||(h={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(f||(f={}));class I extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class T extends I{constructor(e,t){super(e),this.response=t}}class v extends I{constructor(e,t,n,s){super(e),this.status=t,this.statusText=n,this.errorDetails=s}}class R extends I{}class S extends I{}!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(p||(p={}));class A{constructor(e,t,n,s,o){this.model=e,this.task=t,this.apiKey=n,this.stream=s,this.requestOptions=o}toString(){var e,t;let n=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta",s=(null===(t=this.requestOptions)||void 0===t?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",o=`${s}/${n}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}async function N(e){var t;let n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",function(e){let t=[];return(null==e?void 0:e.apiClient)&&t.push(e.apiClient),t.push("genai-js/0.24.1"),t.join(" ")}(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let s=null===(t=e.requestOptions)||void 0===t?void 0:t.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(e){throw new R(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${e.message}`)}for(let[e,t]of s.entries()){if("x-goog-api-key"===e)throw new R(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new R(`Header name ${e} can only be set using the apiClient field`);n.append(e,t)}}return n}async function w(e,t,n,s,o,i){let a=new A(e,t,n,s,i);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}(i)),{method:"POST",headers:await N(a),body:o})}}async function b(e,t,n,s,o,i={},a=fetch){let{url:r,fetchOptions:c}=await w(e,t,n,s,o,i);return M(r,c,a)}async function M(e,t,n=fetch){let s;try{s=await n(e,t)}catch(t){(function(e,t){let n=e;throw"AbortError"===n.name?(n=new S(`Request aborted when fetching ${t.toString()}: ${e.message}`)).stack=e.stack:e instanceof v||e instanceof R||((n=new I(`Error fetching from ${t.toString()}: ${e.message}`)).stack=e.stack),n})(t,e)}return s.ok||await x(s,e),s}async function x(e,t){let n,s="";try{let t=await e.json();s=t.error.message,t.error.details&&(s+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(e){}throw new v(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${s}`,e.status,e.statusText,n)}function $(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),P(e.candidates[0]))throw new T(`${U(e)}`,e);return function(e){var t,n,s,o;let i=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(let t of null===(o=null===(s=e.candidates)||void 0===s?void 0:s[0].content)||void 0===o?void 0:o.parts)t.text&&i.push(t.text),t.executableCode&&i.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&i.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}(e)}if(e.promptFeedback)throw new T(`Text not available. ${U(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),P(e.candidates[0]))throw new T(`${U(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),D(e)[0]}if(e.promptFeedback)throw new T(`Function call not available. ${U(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),P(e.candidates[0]))throw new T(`${U(e)}`,e);return D(e)}if(e.promptFeedback)throw new T(`Function call not available. ${U(e)}`,e)},e}function D(e){var t,n,s,o;let i=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(let t of null===(o=null===(s=e.candidates)||void 0===s?void 0:s[0].content)||void 0===o?void 0:o.parts)t.functionCall&&i.push(t.functionCall);return i.length>0?i:void 0}let L=[d.RECITATION,d.SAFETY,d.LANGUAGE];function P(e){return!!e.finishReason&&L.includes(e.finishReason)}function U(e){var t,n,s;let o="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)o+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(o+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null===(s=e.candidates)||void 0===s?void 0:s[0]){let t=e.candidates[0];P(t)&&(o+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(o+=`: ${t.finishMessage}`))}return o}function j(e){return this instanceof j?(this.v=e,this):new j(e)}"function"==typeof SuppressedError&&SuppressedError;let k=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function H(e){let t=[],n=e.getReader();for(;;){let{done:e,value:s}=await n.read();if(e)return $(function(e){let t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let s of t.candidates)if(n.candidates||(n.candidates=[]),n.candidates[e]||(n.candidates[e]={index:e}),n.candidates[e].citationMetadata=s.citationMetadata,n.candidates[e].groundingMetadata=s.groundingMetadata,n.candidates[e].finishReason=s.finishReason,n.candidates[e].finishMessage=s.finishMessage,n.candidates[e].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[e].content||(n.candidates[e].content={role:s.content.role||"user",parts:[]});let t={};for(let o of s.content.parts)o.text&&(t.text=o.text),o.functionCall&&(t.functionCall=o.functionCall),o.executableCode&&(t.executableCode=o.executableCode),o.codeExecutionResult&&(t.codeExecutionResult=o.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),n.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(n.usageMetadata=t.usageMetadata)}return n}(t));t.push(s)}}async function G(e,t,n,s){return function(e){let[t,n]=(function(e){let t=e.getReader();return new ReadableStream({start(e){let n="";return function s(){return t.read().then(({value:t,done:o})=>{let i;if(o){if(n.trim()){e.error(new I("Failed to parse stream"));return}e.close();return}let a=(n+=t).match(k);for(;a;){try{i=JSON.parse(a[1])}catch(t){e.error(new I(`Error parsing JSON response: "${a[1]}"`));return}e.enqueue(i),a=(n=n.substring(a[0].length)).match(k)}return s()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new S("Request aborted when reading from the stream"):new I("Error reading from the stream")})}()}})})(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))).tee();return{stream:function(e){return function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,o=n.apply(e,t||[]),i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(e){o[e]&&(s[e]=function(t){return new Promise(function(n,s){i.push([e,t,n,s])>1||r(e,t)})})}function r(e,t){try{var n;(n=o[e](t)).value instanceof j?Promise.resolve(n.value.v).then(c,l):d(i[0][2],n)}catch(e){d(i[0][3],e)}}function c(e){r("next",e)}function l(e){r("throw",e)}function d(e,t){e(t),i.shift(),i.length&&r(i[0][0],i[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:n}=yield j(t.read());if(n)break;yield yield j($(e))}})}(t),response:H(n)}}(await b(t,p.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),s))}async function q(e,t,n,s){let o=await b(t,p.GENERATE_CONTENT,e,!1,JSON.stringify(n),s);return{response:$(await o.json())}}function F(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function Y(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let n of e)"string"==typeof n?t.push({text:n}):t.push(n);return function(e){let t={role:"user",parts:[]},n={role:"function",parts:[]},s=!1,o=!1;for(let i of e)"functionResponse"in i?(n.parts.push(i),o=!0):(t.parts.push(i),s=!0);if(s&&o)throw new I("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!o)throw new I("No content is provided for sending chat message.");return s?t:n}(t)}function K(e){let t;return t=e.contents?e:{contents:[Y(e)]},e.systemInstruction&&(t.systemInstruction=F(e.systemInstruction)),t}let B=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],J={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function V(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;if(void 0===n||void 0===n.parts||0===n.parts.length)return!1;for(let e of n.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let z="SILENT_ERROR";class X{constructor(e,t,n,s={}){this.model=t,this.params=n,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(function(e){let t=!1;for(let n of e){let{role:e,parts:s}=n;if(!t&&"user"!==e)throw new I(`First content should be with role 'user', got ${e}`);if(!O.includes(e))throw new I(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(O)}`);if(!Array.isArray(s))throw new I("Content should have 'parts' property with an array of Parts");if(0===s.length)throw new I("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of s)for(let t of B)t in e&&(o[t]+=1);let i=J[e];for(let t of B)if(!i.includes(t)&&o[t]>0)throw new I(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,s,o,i,a,r;let c;await this._sendPromise;let l=Y(e),d={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(s=this.params)||void 0===s?void 0:s.generationConfig,tools:null===(o=this.params)||void 0===o?void 0:o.tools,toolConfig:null===(i=this.params)||void 0===i?void 0:i.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(r=this.params)||void 0===r?void 0:r.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>q(this._apiKey,this.model,d,u)).then(e=>{var t;if(V(e.response)){this._history.push(l);let n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{let t=U(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}c=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,c}async sendMessageStream(e,t={}){var n,s,o,i,a,r;await this._sendPromise;let c=Y(e),l={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(s=this.params)||void 0===s?void 0:s.generationConfig,tools:null===(o=this.params)||void 0===o?void 0:o.tools,toolConfig:null===(i=this.params)||void 0===i?void 0:i.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(r=this.params)||void 0===r?void 0:r.cachedContent,contents:[...this._history,c]},d=Object.assign(Object.assign({},this._requestOptions),t),u=G(this._apiKey,this.model,l,d);return this._sendPromise=this._sendPromise.then(()=>u).catch(e=>{throw Error(z)}).then(e=>e.response).then(e=>{if(V(e)){this._history.push(c);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=U(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==z&&console.error(e)}),u}}async function W(e,t,n,s){return(await b(t,p.COUNT_TOKENS,e,!1,JSON.stringify(n),s)).json()}async function Q(e,t,n,s){return(await b(t,p.EMBED_CONTENT,e,!1,JSON.stringify(n),s)).json()}async function Z(e,t,n,s){let o=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await b(t,p.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),s)).json()}class ee{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=F(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;let s=K(e),o=Object.assign(Object.assign({},this._requestOptions),t);return q(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},s),o)}async generateContentStream(e,t={}){var n;let s=K(e),o=Object.assign(Object.assign({},this._requestOptions),t);return G(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},s),o)}startChat(e){var t;return new X(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let n=function(e,t){var n;let s={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null===(n=null==t?void 0:t.cachedContent)||void 0===n?void 0:n.name,contents:[]},o=null!=e.generateContentRequest;if(e.contents){if(o)throw new R("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(o)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{let t=Y(e);s.contents=[t]}return{generateContentRequest:s}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return W(this.apiKey,this.model,n,s)}async embedContent(e,t={}){let n="string"==typeof e||Array.isArray(e)?{content:Y(e)}:e,s=Object.assign(Object.assign({},this._requestOptions),t);return Q(this.apiKey,this.model,n,s)}async batchEmbedContents(e,t={}){let n=Object.assign(Object.assign({},this._requestOptions),t);return Z(this.apiKey,this.model,e,n)}}class et{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new I("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new ee(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new R("Cached content must contain a `name` field.");if(!e.model)throw new R("Cached content must contain a `model` field.");for(let n of["model","systemInstruction"])if((null==t?void 0:t[n])&&e[n]&&(null==t?void 0:t[n])!==e[n]){if("model"===n&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new R(`Different value for "${n}" specified in modelParams (${t[n]}) and cachedContent (${e[n]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new ee(this.apiKey,s,n)}}var en=n(2048),es=n(5315);let eo=new et(process.env.GOOGLE_API_KEY||""),ei="";try{ei=(0,en.readFileSync)((0,es.join)(process.cwd(),"content","trading-rulebook.md"),"utf-8")}catch{console.warn("Trading rulebook not found at content/trading-rulebook.md")}async function ea(e){try{let t="true"===process.env.DEV_BYPASS_AUTH,n=t?await (0,C.m)():await (0,C.e)(),s=null;if(!t){let{data:{user:e}}=await n.auth.getUser();if(!e)return y.NextResponse.json({error:"Unauthorized"},{status:401});s=e.id;let{data:t}=await n.from("subscriptions").select("status").eq("user_id",e.id).single();if(!t||!["active","comped"].includes(t.status))return y.NextResponse.json({error:"Active subscription required"},{status:403});let o=new Date().toISOString().split("T")[0],{data:i}=await n.from("chat_usage").select("message_count").eq("user_id",e.id).eq("usage_date",o).single();if(i&&i.message_count>=15)return y.NextResponse.json({error:"Daily message limit reached. Resets at midnight ET."},{status:429})}let{message:o,history:i}=await e.json();if(!o||"string"!=typeof o)return y.NextResponse.json({error:"Message required"},{status:400});let{data:a}=await n.from("reports").select("extracted_data, report_date").order("report_date",{ascending:!1}).limit(1).single(),r=null;if(s){let{data:e}=await n.from("user_settings").select("*").eq("user_id",s).single();r=e}let c=function(e,t){let n=`You are the Flacko AI trading assistant. You help users understand their daily TSLA trading reports and provide framework-based guidance.

IMPORTANT RULES:
1. Never give specific "buy at $X" or "sell at $Y" advice
2. Always frame guidance in terms of the trading framework (Traffic Light System, position sizing rules)
3. Be helpful but remind users that this is educational, not financial advice
4. Help users calculate position sizes based on their settings
5. Explain concepts clearly (BX-Trender, SMI, gamma, Master Eject, etc.)
6. Keep responses concise and actionable
7. Reference specific data from the current report when answering questions

`;if(ei&&(n+=`=== TRADING RULEBOOK ===
${ei}
=== END RULEBOOK ===

`),e){let t=e.extracted_data;if(n+=`=== CURRENT REPORT (${e.report_date}) ===

MODE & STATUS:
- Current Mode: ${t.mode?.current?.toUpperCase()||"Unknown"} (${t.mode?.label||""})
- Mode Summary: ${t.mode?.summary||"No summary available"}
- Position Stance: ${t.position?.current_stance||"See report for details"}
- Size Recommendation: ${t.position?.size_recommendation||"Partial"}
- Daily Cap for this mode: ${t.position?.daily_cap_pct||25}%

PRICE DATA:
- TSLA Close: $${t.price?.close||0}
- Daily Change: ${t.price?.change_pct||0}%
${t.price?.range?`- Day Range: $${t.price.range.low} - $${t.price.range.high}`:""}

CRITICAL LEVELS:
- Master Eject (EXIT if broken): $${t.master_eject?.price||0}
- Entry Quality Score: ${t.entry_quality?.score||0}/5

`,t.alerts&&t.alerts.length>0){n+=`KEY PRICE LEVELS:
`;let e=t.alerts.filter(e=>"upside"===e.type),s=t.alerts.filter(e=>"downside"===e.type);e.length>0&&(n+=`
Upside Targets:
`,e.forEach(e=>{n+=`- $${e.price} (${e.level_name}): ${e.action||""} - ${e.reason||""}
`})),s.length>0&&(n+=`
Downside Supports:
`,s.forEach(e=>{n+=`- $${e.price} (${e.level_name}): ${e.action||""} - ${e.reason||""}
`})),n+=`
`}t.technicals&&(n+=`TECHNICAL INDICATORS:
`,t.technicals.bx_trender&&(n+=`- BX-Trender: Daily=${t.technicals.bx_trender.daily}, Weekly=${t.technicals.bx_trender.weekly}, Monthly=${t.technicals.bx_trender.monthly}
`),t.technicals.smi&&(n+=`- SMI: ${t.technicals.smi.value} (${t.technicals.smi.signal})
`),t.technicals.ema_status&&(n+=`- EMA Status: ${t.technicals.ema_status}
`),n+=`
`),t.qqq_status&&(n+=`QQQ MARKET CONTEXT:
${t.qqq_status}

`),n+=`=== END REPORT ===

`}else n+=`NOTE: No report data available yet. Help the user with general framework questions based on the rulebook.

`;if(t){let e=t.portfolio_size_exact?`$${t.portfolio_size_exact.toLocaleString()}`:t.portfolio_size?.replace("_","-").replace("k","K")||"Not set",s=t.daily_cap_pct||10,o=t.portfolio_size_exact?`$${(t.portfolio_size_exact*s/100).toLocaleString()}`:"Not calculated";n+=`USER'S TRADING SETTINGS:
- Portfolio Size: ${e}
- User's Daily Cap Setting: ${s}% (${o} daily budget)
- Risk Tolerance: ${t.risk_tolerance||"Moderate"}
- Per-Trade Limit: ${t.per_trade_limit_pct||2}%
- Options Cap: ${t.options_cap_pct||20}%

`}return n+="When calculating position sizes, use the user's portfolio size and the current mode's daily cap percentage. Show your math clearly. Reference specific prices and levels from the report when relevant."}(a,r),l=eo.getGenerativeModel({model:"gemini-2.0-flash",systemInstruction:c}),d=(i||[]).map(e=>({role:"user"===e.role?"user":"model",parts:[{text:e.content}]})),u=l.startChat({history:d}),h=(await u.sendMessage(o)).response.text();if(s&&!t){let e=new Date().toISOString().split("T")[0],{data:t}=await n.from("chat_usage").select("message_count").eq("user_id",s).eq("usage_date",e).single();await n.from("chat_usage").upsert({user_id:s,usage_date:e,message_count:(t?.message_count||0)+1},{onConflict:"user_id,usage_date"})}return y.NextResponse.json({response:h})}catch(e){return console.error("Chat error:",e),y.NextResponse.json({error:"Internal server error"},{status:500})}}let er=new m.AppRouteRouteModule({definition:{kind:E.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/Users/justinhoffmann/Desktop/Flacko_AI/flacko-ai/app/api/chat/route.ts",nextConfigOutput:"",userland:g}),{requestAsyncStorage:ec,staticGenerationAsyncStorage:el,serverHooks:ed}=er,eu="/api/chat/route";function eh(){return(0,_.patchFetch)({serverHooks:ed,staticGenerationAsyncStorage:el})}},9692:(e,t,n)=>{n.d(t,{e:()=>i,m:()=>a});var s=n(2728),o=n(1615);async function i(){let e=await (0,o.cookies)();return(0,s.createServerClient)("https://rctbqtemkahdbifxrqom.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjdGJxdGVta2FoZGJpZnhycW9tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwMjQ1OTIsImV4cCI6MjA4NDYwMDU5Mn0.99yALEdL5RVDuVPa_2_e3AFi6u-4PTogGUQ9_HHyqos",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:n,options:s})=>e.set(t,n,s))}catch{}}}})}async function a(){let e=await (0,o.cookies)();return(0,s.createServerClient)("https://rctbqtemkahdbifxrqom.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:n,options:s})=>e.set(t,n,s))}catch{}}}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),s=t.X(0,[9276,3637,5972],()=>n(5256));module.exports=s})();