"use strict";(()=>{var e={};e.id=9867,e.ids=[9867],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},2048:e=>{e.exports=require("fs")},5429:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>_,staticGenerationAsyncStorage:()=>g});var n={};t.r(n),t.d(n,{GET:()=>d,POST:()=>D});var s=t(9303),o=t(8716),a=t(670),i=t(9692),u=t(7070),l=t(9454),c=t(9554),p=t(2746);async function d(){try{let e=await (0,i.e)();if("true"!==process.env.DEV_BYPASS_AUTH){let{data:{user:r}}=await e.auth.getUser();if(!r)return u.NextResponse.json({error:"Unauthorized"},{status:401})}let{data:r,error:t}=await e.from("reports").select("*").order("report_date",{ascending:!1}).limit(30);if(t)return u.NextResponse.json({error:t.message},{status:500});return u.NextResponse.json({reports:r})}catch(e){return u.NextResponse.json({error:"Internal server error"},{status:500})}}async function D(e){try{let r=await (0,i.e)(),t=await (0,i.m)();if("true"!==process.env.DEV_BYPASS_AUTH){let{data:{user:e}}=await r.auth.getUser();if(!e)return u.NextResponse.json({error:"Unauthorized"},{status:401});let{data:t}=await r.from("users").select("is_admin").eq("id",e.id).single();if(!t?.is_admin)return u.NextResponse.json({error:"Admin access required"},{status:403})}let{markdown:n}=await e.json();if(!n)return u.NextResponse.json({error:"Markdown content required"},{status:400});let{parsed_data:s,extracted_data:o,warnings:a}=(0,l.Lq)(n),d=(0,l.U0)(o);if(d.length>0)return u.NextResponse.json({error:"Validation failed",errors:d},{status:400});let D=new Date().toISOString().split("T")[0],{data:m,error:f}=await t.from("reports").upsert({report_date:D,raw_markdown:n,parsed_data:s,extracted_data:o,parser_version:l.aL,parser_warnings:a,updated_at:new Date().toISOString()},{onConflict:"report_date"}).select().single();if(f)return u.NextResponse.json({error:f.message},{status:500});let{data:g}=await t.from("subscriptions").select("user_id").in("status",["active","comped"]);if(g&&o.alerts){let e=[];for(let r of g){let{data:n}=await t.from("user_settings").select("alerts_enabled").eq("user_id",r.user_id).single();if(n?.alerts_enabled!==!1)for(let t of o.alerts)e.push({report_id:m.id,user_id:r.user_id,price:t.price,type:t.type,level_name:t.level_name,action:t.action,reason:t.reason})}e.length>0&&await t.from("report_alerts").insert(e)}let _=(0,p.G)({mode:o.mode?.current||"yellow",reportDate:D,closePrice:o.price?.close||0,changePct:o.price?.change_pct||0,alerts:o.alerts||[],positioning:o.positioning,tiers:o.tiers,masterEject:o.master_eject?.price});return await (0,c.B)(_),u.NextResponse.json({success:!0,report:m})}catch(e){return console.error("Report upload error:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/reports/route",pathname:"/api/reports",filename:"route",bundlePath:"app/api/reports/route"},resolvedPagePath:"/Users/justinhoffmann/Desktop/Flacko_AI/flacko-ai/app/api/reports/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:_}=m,y="/api/reports/route";function w(){return(0,a.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:g})}},9554:(e,r,t)=>{t.d(r,{B:()=>s,a:()=>o});let n=process.env.DISCORD_WEBHOOK_URL;async function s(e){if(!n)return console.error("DISCORD_WEBHOOK_URL is not set"),!1;try{let r=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)return console.error(`Discord webhook error: ${r.status}`),!1;return!0}catch(e){return console.error("Error sending Discord message:",e),!1}}let o={green:2278750,yellow:15381256,red:15680580,blue:3900150}},2746:(e,r,t)=>{t.d(r,{G:()=>a,Q:()=>o});var n=t(9554),s=t(650);function o({alerts:e,currentPrice:r,mode:t}){let o=e.map(e=>{let r="upside"===e.type;return`${r?"\uD83D\uDFE2":"\uD83D\uDD34"} **${e.level_name}** @ ${(0,s.T4)(e.price)}
${r?"\uD83D\uDCC8 TAKE PROFIT":"\uD83D\uDCB0 BUY THE DIP"}: **${e.action}**${e.reason?`
_${e.reason}_`:""}`}).join("\n\n");return{embeds:[{title:"âš¡ TSLA Price Alert Triggered!",description:`Current price: **${(0,s.T4)(r)}** ${"green"===t?"\uD83D\uDFE2":"yellow"===t?"\uD83D\uDFE1":"\uD83D\uDD34"} ${t.toUpperCase()} MODE

${o}`,color:n.a.blue,footer:{text:"Set by Flacko AI â€¢ Check app for full details"}}]}}function a({mode:e,reportDate:r,closePrice:t,changePct:o,alerts:a,positioning:i,tiers:u,masterEject:l}){let c=a.filter(e=>"upside"===e.type),p=a.filter(e=>"downside"===e.type),d=`## ${"green"===e?"\uD83D\uDFE2":"yellow"===e?"\uD83D\uDFE1":"\uD83D\uDD34"} ${e.toUpperCase()} MODE
`;if(d+=`**${r}**

`,u){let e=e=>"green"===e?"\uD83D\uDFE2":"red"===e?"\uD83D\uDD34":"\uD83D\uDFE1";d+=`**Tiers:** ${e(u.regime)} Regime | ${e(u.trend)} Trend | ${e(u.timing)} Timing | ${e(u.flow)} Flow

`}return i&&(d+=`**Today's Positioning**
`,i.daily_cap&&(d+=`â€¢ Daily Cap: ${i.daily_cap}
`),i.vehicle&&(d+=`â€¢ Vehicle: ${i.vehicle}
`),i.posture&&(d+=`â€¢ Posture: ${i.posture}
`),d+="\n"),c.length>0&&(d+=`**ðŸ“ˆ Take Profit Levels**
`+c.map(e=>`ðŸŸ¢ **${(0,s.T4)(e.price)}** â€” ${e.level_name} â†’ ${e.action}`).join("\n")+"\n\n"),p.length>0&&(d+=`**ðŸ’° Buy the Dip Levels**
`+p.map(e=>`ðŸ”´ **${(0,s.T4)(e.price)}** â€” ${e.level_name} â†’ ${e.action}`).join("\n")+"\n\n"),l&&l>0&&(d+=`**âš ï¸ Master Eject: ${(0,s.T4)(l)}**
_Daily close below = exit all positions_`),{embeds:[{title:"\uD83D\uDCCA New TSLA Daily Report",description:d.trim(),color:n.a[e],footer:{text:"Flacko AI â€¢ Alerts auto-set â€¢ View app for full analysis"}}]}}},650:(e,r,t)=>{t.d(r,{T3:()=>u,T4:()=>l,cn:()=>o,p6:()=>i,xG:()=>a});var n=t(5761),s=t(2386);function o(...e){return(0,s.m6)((0,n.W)(e))}function a(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e/100)}function i(e){return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(new Date(e))}function u(e,r=2){return`${e>=0?"+":""}${e.toFixed(r)}%`}function l(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[9276,3637,5972,86,3673,9853],()=>t(5429));module.exports=n})();