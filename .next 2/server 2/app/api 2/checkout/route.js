"use strict";(()=>{var e={};e.id=1607,e.ids=[1607],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},1764:e=>{e.exports=require("util")},4791:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>p});var i=r(9303),n=r(8716),c=r(670),a=r(9692),o=r(7070),u=r(9786);async function p(){try{let e,t;let r=await (0,a.e)(),s=await (0,a.m)(),{data:{user:i}}=await r.auth.getUser();if(!i)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{data:n}=await r.from("subscriptions").select("status, locked_price_cents, price_tier").eq("user_id",i.id).single();if(n?.status==="active")return o.NextResponse.json({error:"Already subscribed"},{status:400});if(n?.locked_price_cents)e=n.locked_price_cents,t=n.price_tier;else{let{count:r}=await s.from("subscriptions").select("*",{count:"exact",head:!0}).in("status",["active","comped"]);t=(0,u.K4)(r||0),e=(0,u.B1)(t)}let c=await (0,u.Mc)({userId:i.id,email:i.email,priceInCents:e,tier:t,successUrl:"http://localhost:3000/?success=true",cancelUrl:"http://localhost:3000/pricing?canceled=true"});return n||await s.from("subscriptions").insert({user_id:i.id,status:"pending",price_tier:t,locked_price_cents:e}),o.NextResponse.json({url:c.url})}catch(e){return console.error("Checkout error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/checkout/route",pathname:"/api/checkout",filename:"route",bundlePath:"app/api/checkout/route"},resolvedPagePath:"/Users/justinhoffmann/Desktop/Flacko_AI/flacko-ai/app/api/checkout/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:m}=l,_="/api/checkout/route";function x(){return(0,c.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},9786:(e,t,r)=>{r.d(t,{Ag:()=>s,B1:()=>c,Eu:()=>u,K4:()=>n,Mc:()=>o,UD:()=>a});let s=new(r(9256)).Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2024-12-18.acacia",typescript:!0}),i=[2999,3499,3999,4499,4999,5499,5999,6499,6999,7499,7999,8499,8999,9499,9999];function n(e){return Math.min(Math.floor(e/40)+1,i.length)}function c(e){let t=Math.min(e-1,i.length-1);return i[t]}function a(e){return`$${(e/100).toFixed(2)}`}async function o({userId:e,email:t,priceInCents:r,tier:i,successUrl:n,cancelUrl:c}){return await s.checkout.sessions.create({customer_email:t,mode:"subscription",payment_method_types:["card"],line_items:[{price_data:{currency:"usd",product_data:{name:"Flacko AI Subscription",description:`TSLA Trading Intelligence - Tier ${i}`},unit_amount:r,recurring:{interval:"month"}},quantity:1}],metadata:{user_id:e,price_tier:i.toString(),locked_price_cents:r.toString()},success_url:n,cancel_url:c,subscription_data:{metadata:{user_id:e,price_tier:i.toString(),locked_price_cents:r.toString()}}})}async function u({customerId:e,returnUrl:t}){return await s.billingPortal.sessions.create({customer:e,return_url:t})}},9692:(e,t,r)=>{r.d(t,{e:()=>n,m:()=>c});var s=r(2728),i=r(1615);async function n(){let e=await (0,i.cookies)();return(0,s.createServerClient)("https://rctbqtemkahdbifxrqom.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjdGJxdGVta2FoZGJpZnhycW9tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwMjQ1OTIsImV4cCI6MjA4NDYwMDU5Mn0.99yALEdL5RVDuVPa_2_e3AFi6u-4PTogGUQ9_HHyqos",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}})}async function c(){let e=await (0,i.cookies)();return(0,s.createServerClient)("https://rctbqtemkahdbifxrqom.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,3637,5972,9256],()=>r(4791));module.exports=s})();